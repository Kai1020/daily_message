{% extends "base.html" %}
{% block title %}Love Story Mode{% endblock %}

{% block content %}

<div class="card" id="storyBox" style="transition:opacity .4s, transform .4s;">
    <h2 id="titleText" style="margin-top:0;"></h2>
    <p id="storyText" style="line-height:1.6; font-size:17px;"></p>

    <div id="choices"
         style="margin-top:20px; display:flex; flex-direction:column; gap:12px;">
    </div>

    <div style="margin-top:25px; display:flex; gap:12px; flex-wrap:wrap;">
        <button class="btn" onclick="saveGame()">Save Game ğŸ’¾</button>
        <button class="btn" onclick="restartGame()">Restart ğŸ”„</button>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>

// ------------------------------------
// SAVE / LOAD SYSTEM
// ------------------------------------

function saveGame() {
    localStorage.setItem("shahad_story_progress", currentStep);
    alert("Saved! Your progress is safe ğŸ’—");
}

function loadGame() {
    const saved = localStorage.getItem("shahad_story_progress");

    if (saved) {
        currentStep = saved;
        playStep(currentStep);
    } else {
        startStory();
    }
}

function restartGame() {
    if (confirm("Start over from the beginning?")) {
        localStorage.removeItem("shahad_story_progress");
        startStory();
    }
}

// ------------------------------------
// STORY ENGINE
// ------------------------------------

let currentStep = "start";

function fadeCardOut() {
    const card = document.getElementById("storyBox");
    card.style.opacity = "0";
    card.style.transform = "translateY(10px)";
}

function fadeCardIn() {
    const card = document.getElementById("storyBox");
    card.style.opacity = "1";
    card.style.transform = "translateY(0px)";
}

function transitionStory(title, text, buttonsHtml) {
    fadeCardOut();

    setTimeout(() => {
        document.getElementById("titleText").innerHTML = title;
        document.getElementById("storyText").innerHTML = text;
        document.getElementById("choices").innerHTML = buttonsHtml;
        fadeCardIn();
    }, 350);
}

// ------------------------------------
// STORY PATH
// ------------------------------------

function startStory() {
    playStep("start");
}

function playStep(step) {
    currentStep = step;
    localStorage.setItem("shahad_story_progress", currentStep); // auto-save

    switch(step) {

        // ---------------------------
        // CHAPTER 1
        // ---------------------------

        case "start":
            transitionStory(
                "Chapter 1 â€” The Pink Envelope âœ‰ï¸",
                `Shahad finds a soft pink envelope resting on her pillowâ€¦  
                 It glows faintly, as if itâ€™s waiting for her fingers.`,
                `
                    <button class='btn' onclick="playStep('open')">Open it ğŸ’Œ</button>
                    <button class='btn' onclick="playStep('hold')">Hold it close ğŸ’—</button>
                    <button class='btn' onclick="playStep('inspect')">Inspect it ğŸ‘€</button>
                `
            );
            break;

        // ---------------------------
        // CHAPTER 2
        // ---------------------------

        case "open":
            transitionStory(
                "Chapter 2 â€” The Message Glows âœ¨",
                `"Follow your heart," the card whispers softly.  
                 A warm light spreads across the room.`,
                `
                    <button class='btn' onclick="playStep('lightPath')">Follow the light âœ¨</button>
                    <button class='btn' onclick="playStep('think')">Pause and think ğŸ§¸</button>
                `
            );
            break;

        case "hold":
            transitionStory(
                "Chapter 2 â€” Warmth in Her Hands ğŸ’",
                `The envelope warms as she holds itâ€¦ a gentle, loving warmth  
                 like someone thinking of her.`,
                `
                    <button class='btn' onclick="playStep('slowOpen')">Open it slowly âœ‰ï¸</button>
                    <button class='btn' onclick="playStep('warmthGuide')">Follow the warmth ğŸ’—</button>
                `
            );
            break;

        case "inspect":
            transitionStory(
                "Chapter 2 â€” Runes of Soft Light ğŸ”®",
                `Tiny glowing runes shift around the edgesâ€¦ whispering softly.`,
                `
                    <button class='btn' onclick="playStep('decipher')">Try to read them ğŸ”®</button>
                    <button class='btn' onclick="playStep('open')">Open it âœ‰ï¸</button>
                `
            );
            break;

        // ---------------------------
        // CHAPTER 3
        // ---------------------------

        case "lightPath":
            transitionStory(
                "Chapter 3 â€” A Path of Light ğŸŒ™",
                `A trail of soft pink light appearsâ€¦ shimmering, inviting.`,
                `<button class='btn' onclick="playStep('gate')">Follow the path ğŸŒ¸</button>`
            );
            break;

        case "think":
            transitionStory(
                "Chapter 3 â€” A Quiet Thought ğŸ’­",
                `She wonders who sent this.  
                 The warmth in her chest feels familiarâ€¦`,
                `<button class='btn' onclick="playStep('lightPath')">Follow the light âœ¨</button>`
            );
            break;

        case "slowOpen":
            transitionStory(
                "Chapter 3 â€” A Floating Petal ğŸŒº",
                `A single glowing pink petal drifts upward,  
                 calling her softly.`,
                `<button class='btn' onclick="playStep('petalFollow')">Follow the petal ğŸŒ¬ï¸</button>`
            );
            break;

        case "warmthGuide":
            transitionStory(
                "Chapter 3 â€” Firefly Road âœ¨",
                `Fireflies gather around herâ€¦  
                 forming a glowing heart-shaped path.`,
                `<button class='btn' onclick="playStep('firefly')">Walk the path ğŸ’—</button>`
            );
            break;

        case "decipher":
            transitionStory(
                "Chapter 3 â€” Runes of Love ğŸ’«",
                `The runes whisper gently:  
                 â€œYou are loved more than you know, Shahad.â€`,
                `<button class='btn' onclick="playStep('open')">Open it âœ‰ï¸</button>`
            );
            break;

        // ---------------------------
        // CHAPTER 4 â€” FINAL STEPS
        // ---------------------------

        case "gate":
            transitionStory(
                "Chapter 4 â€” The Blossom Gate ğŸŒ¸",
                `A grand gate made of petals blooms open before herâ€¦`,
                `<button class='btn' onclick="playStep('ending1')">Step inside ğŸŒ¸</button>`
            );
            break;

        case "petalFollow":
            transitionStory(
                "Chapter 4 â€” Heart Clearing ğŸ’—",
                `The glowing petal leads her into  
                 a clearing shaped like a perfect heart.`,
                `<button class='btn' onclick="playStep('ending2')">Enter the heart ğŸ’</button>`
            );
            break;

        case "firefly":
            transitionStory(
                "Chapter 4 â€” Lanterns of Love âœ¨",
                `Fireflies swirl together,  
                 forming a doorway of warm, soft light.`,
                `<button class='btn' onclick="playStep('ending3')">Walk through âœ¨</button>`
            );
            break;

        // ---------------------------
        // ENDINGS
        // ---------------------------

        case "ending1":
            transitionStory(
                "Ending â€” Blossoms of Love ğŸŒ¸",
                `Soft petals drift around her like a gentle storm of affection.  
                 A quiet voice whispers:  
                 <br><br><i>â€œYou are cherished more than words can hold, Shahad.â€</i>`,
                `<button class='btn' onclick="restartGame()">Play Again ğŸ”„</button>`
            );
            break;

        case "ending2":
            transitionStory(
                "Ending â€” Heartâ€™s Home ğŸ’—",
                `The clearing glows softlyâ€¦ warm, safe, familiar.  
                 She feels wrapped in gentle, unwavering love.`,
                `<button class='btn' onclick="restartGame()">Play Again ğŸ”„</button>`
            );
            break;

        case "ending3":
            transitionStory(
                "Ending â€” Light of Love âœ¨",
                `The light surrounds her like a warm embrace.  
                 She smiles, realizing she was never walking alone.`,
                `<button class='btn' onclick="restartGame()">Play Again ğŸ”„</button>`
            );
            break;
    }
}

// ------------------------------------
// ON PAGE LOAD
// ------------------------------------

window.onload = loadGame;

</script>
{% endblock %}
