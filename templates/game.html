{% extends "base.html" %}
{% block title %}Love Story Mode{% endblock %}

{% block content %}

<div class="card" id="storyBox" style="transition: .5s;">
    <h2 id="titleText"></h2>
    <p id="storyText"></p>

    <div id="choices" style="margin-top:16px; display:flex; flex-direction:column; gap:10px;"></div>

    <div style="margin-top:20px; display:flex; gap:10px;">
        <button class="btn" onclick="saveGame()">Save Game ğŸ’¾</button>
        <button class="btn" onclick="restartGame()">Restart ğŸ”„</button>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>

// -------------------------------
// SAVE / LOAD SYSTEM
// -------------------------------

function saveGame() {
    localStorage.setItem("shahad_story_progress", currentStep);
    alert("Game Saved! ğŸ’—");
}

function loadGame() {
    let saved = localStorage.getItem("shahad_story_progress");
    if (saved) {
        currentStep = saved;
        playStep(currentStep);
    } else {
        startStory();
    }
}

function restartGame() {
    if (confirm("Restart the story?")) {
        localStorage.removeItem("shahad_story_progress");
        startStory();
    }
}

// -------------------------------
// STORY ENGINE
// -------------------------------

let currentStep = "start";

function transitionStory(title, text, buttonsHtml) {
    const box = document.getElementById("storyBox");
    box.style.opacity = "0";

    setTimeout(() => {
        document.getElementById("titleText").innerHTML = title;
        document.getElementById("storyText").innerHTML = text;
        document.getElementById("choices").innerHTML = buttonsHtml;
        box.style.opacity = "1";
    }, 400);
}

function playStep(step) {
    currentStep = step;

    // Save automatically after every step (optional)
    localStorage.setItem("shahad_story_progress", currentStep);

    switch(step) {

        // -------------------------------
        // CHAPTER 1
        // -------------------------------

        case "start":
            transitionStory(
                "Chapter 1 â€” The Pink Envelope âœ‰ï¸",
                `Shahad discovers a soft pink envelope on her pillow, glowing gently...`,
                `
                <button class='btn' onclick="playStep('open')">Open it ğŸ’Œ</button>
                <button class='btn' onclick="playStep('hold')">Hold it close ğŸ’—</button>
                <button class='btn' onclick="playStep('inspect')">Inspect it ğŸ‘€</button>
                `
            );
            break;

        // -------------------------------
        // CHAPTER 2
        // -------------------------------

        case "open":
            transitionStory(
                "Chapter 2 â€” The Message Glows âœ¨",
                `Inside is a shimmering card: "Follow your heart. It knows the way."`,
                `
                <button class='btn' onclick="playStep('lightPath')">Follow the glowing light âœ¨</button>
                <button class='btn' onclick="playStep('think')">Sit and think ğŸ§¸</button>
                `
            );
            break;

        case "hold":
            transitionStory(
                "Chapter 2 â€” Warmth in Her Hands ğŸ’",
                `The envelope warms in her handsâ€¦ soft, comforting, full of love.`,
                `
                <button class='btn' onclick="playStep('slowOpen')">Open it slowly âœ‰ï¸</button>
                <button class='btn' onclick="playStep('warmthGuide')">Follow the warmth ğŸ’—</button>
                `
            );
            break;

        case "inspect":
            transitionStory(
                "Chapter 2 â€” Hidden Runes ğŸ”®",
                `Tiny runes glow along the envelopeâ€™s edge. They shift softly.`,
                `
                <button class='btn' onclick="playStep('decipher')">Try to read them ğŸ”®</button>
                <button class='btn' onclick="playStep('open')">Open it âœ‰ï¸</button>
                `
            );
            break;

        // -------------------------------
        // CHAPTER 3
        // -------------------------------

        case "lightPath":
            transitionStory(
                "Chapter 3 â€” Path of Light ğŸŒ™",
                `A trail of soft pink light appears, leading outside.`,
                `<button class='btn' onclick="playStep('gate')">Follow the path ğŸŒ¸</button>`
            );
            break;

        case "think":
            transitionStory(
                "Chapter 3 â€” A Soft Thought ğŸ’­",
                `She pausesâ€¦ wondering who sent this gift.`,
                `<button class='btn' onclick="playStep('lightPath')">Follow the light âœ¨</button>`
            );
            break;

        case "slowOpen":
            transitionStory(
                "Chapter 3 â€” Petal of Magic ğŸŒº",
                `Inside is a glowing pink petal drifting upward...`,
                `<button class='btn' onclick="playStep('petalFollow')">Follow the petal ğŸŒ¬ï¸</button>`
            );
            break;

        case "warmthGuide":
            transitionStory(
                "Chapter 3 â€” Firefly Road âœ¨",
                `Fireflies gatherâ€¦ forming a heart-shaped path.`,
                `<button class='btn' onclick="playStep('firefly')">Walk the path ğŸ’—</button>`
            );
            break;

        case "decipher":
            transitionStory(
                "Chapter 3 â€” Runes of Love ğŸ’«",
                `The runes whisper: â€œYou are loved more than you know, Shahad.â€`,
                `<button class='btn' onclick="playStep('open')">Open it âœ‰ï¸</button>`
            );
            break;

        // -------------------------------
        // CHAPTER 4 (Final Choices)
        // -------------------------------

        case "gate":
            transitionStory(
                "Chapter 4 â€” Gate of Blossoms ğŸŒ¸",
                `A giant pink blossom gate opensâ€¦ inviting her inside.`,
                `<button class='btn' onclick="playStep('ending1')">Walk through ğŸŒ¸</button>`
            );
            break;

        case "petalFollow":
            transitionStory(
                "Chapter 4 â€” Heart Clearing ğŸ’—",
                `The petal guides her to a clearing shaped like a heart.`,
                `<button class='btn' onclick="playStep('ending2')">Step inside ğŸ’</button>`
            );
            break;

        case "firefly":
            transitionStory(
                "Chapter 4 â€” Lanterns of Love âœ¨",
                `Fireflies swirl into a glowing doorway of light.`,
                `<button class='btn' onclick="playStep('ending3')">Enter the light âœ¨</button>`
            );
            break;

        // -------------------------------
        // ENDINGS
        // -------------------------------

        case "ending1":
            transitionStory(
                "Ending â€” Blossoms of Love ğŸŒ¸",
                `As she steps through, blossoms fall gently around her.  
                 A soft voice whispers:  
                 <br><br>â€œYou are cherished more than words can hold, Shahad.â€`,
                `<button class='btn' onclick="restartGame()">Play Again ğŸ”„</button>`
            );
            break;

        case "ending2":
            transitionStory(
                "Ending â€” Heartâ€™s Home ğŸ’—",
                `The clearing glowsâ€¦ warm, bright, safe.  
                 She feels deeply loved, held by a gentle presence.`,
                `<button class='btn' onclick="restartGame()">Play Again ğŸ”„</button>`
            );
            break;

        case "ending3":
            transitionStory(
                "Ending â€” Light of Love âœ¨",
                `The light wraps around her like a warm hug.  
                 She smiles softly, knowing she is never alone.`,
                `<button class='btn' onclick="restartGame()">Play Again ğŸ”„</button>`
            );
            break;
    }
}

// -------------------------------
// ON PAGE LOAD
// -------------------------------
window.onload = loadGame;

</script>
{% endblock %}
